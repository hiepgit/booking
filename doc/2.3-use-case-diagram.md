### 2.3. Use Case Diagram

Sơ đồ thể hiện mối quan hệ giữa các tác nhân (Bệnh nhân, Bác sĩ, Admin) và các chức năng chính của hệ thống.

```mermaid
graph LR
  patient["Bệnh nhân"]
  doctor["Bác sĩ"]
  admin["Admin"]

  %% Bệnh nhân
  subgraph "Use Cases - Bệnh nhân"
    uc_register("Đăng ký/Đăng nhập")
    uc_otp("Xác thực OTP")
    uc_profile("Quản lý hồ sơ")
    uc_search("Tìm kiếm bác sĩ")
    uc_view_slots("Xem lịch trống")
    uc_book("Đặt lịch khám")
    uc_notes("Ghi chú triệu chứng")
    uc_pay("Thanh toán")
    uc_cancel("Hủy lịch")
    uc_reschedule("Dời lịch")
    uc_policy("Kiểm tra chính sách hủy/dời")
    uc_online("Khám online (telemedicine)")
    uc_meeting_link("Tạo/nhúng link cuộc gọi")
    uc_records("Hồ sơ/KQ khám")
    uc_review("Đánh giá bác sĩ")
    uc_chat("Chat/Tư vấn")
    uc_notify("Nhắc lịch/Thông báo")
    uc_attach("Đính kèm kết quả/đơn")
  end

  %% Bác sĩ
  subgraph "Use Cases - Bác sĩ"
    uc_schedule("Thiết lập lịch làm việc")
    uc_busy("Báo bận/Nghỉ phép")
    uc_visit("Khám & ghi chú")
    uc_view_patient("Xem thông tin bệnh nhân")
    uc_medical_record("Lập hồ sơ bệnh án")
    uc_prescription("Kê đơn điện tử")
    uc_manage_patients("Quản lý bệnh nhân")
  end

  %% Admin
  subgraph "Use Cases - Admin"
    uc_admin_users("Quản lý người dùng")
    uc_approve_doctor("Duyệt bác sĩ")
    uc_admin_specialties("Quản lý chuyên khoa/phòng khám")
    uc_admin_stats("Thống kê/Báo cáo")
    uc_admin_feedback("Khiếu nại/Feedback")
  end

  %% Hệ thống ngoài
  subgraph "Hệ thống ngoài"
    payGw[["Cổng thanh toán (VNPay/MoMo)"]]
    emailSvc[["Email Service"]]
    meetSvc[["Meeting Provider (Zoom/Meet)"]]
    storageSvc[["Lưu trữ (Cloudinary)"]]
  end

  %% Liên kết Actor → Use case
  patient --> uc_register
  patient --> uc_profile
  patient --> uc_search
  patient --> uc_book
  patient --> uc_cancel
  patient --> uc_reschedule
  patient --> uc_online
  patient --> uc_records
  patient --> uc_review
  patient --> uc_chat
  patient --> uc_notify

  doctor --> uc_schedule
  doctor --> uc_visit
  doctor --> uc_prescription
  doctor --> uc_manage_patients
  doctor --> uc_chat
  doctor --> uc_notify

  admin --> uc_admin_users
  admin --> uc_admin_specialties
  admin --> uc_admin_stats
  admin --> uc_admin_feedback

  %% include / extend giữa Use cases
  uc_register -. include .-> uc_otp
  uc_book -. include .-> uc_view_slots
  uc_book -. extend .-> uc_notes
  uc_book -. extend .-> uc_pay
  uc_cancel -. include .-> uc_policy
  uc_reschedule -. include .-> uc_policy
  uc_online -. include .-> uc_meeting_link

  uc_schedule -. include .-> uc_busy
  uc_visit -. include .-> uc_view_patient
  uc_visit -. include .-> uc_medical_record
  uc_medical_record -. include .-> uc_attach
  uc_medical_record -. extend .-> uc_prescription

  uc_admin_users -. include .-> uc_approve_doctor

  %% Hệ thống ngoài
  uc_pay --> payGw
  uc_notify --> emailSvc
  uc_meeting_link --> meetSvc
  uc_attach --> storageSvc
```

Ghi chú: cạnh nét đứt có nhãn include/extend biểu thị quan hệ bắt buộc/mở rộng giữa các use case.


